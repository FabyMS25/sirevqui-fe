<!-- Start Breadcrumbs -->
<app-breadcrumbs [title]="title" [breadcrumbItems]="breadCrumbItems"></app-breadcrumbs>
<!-- End Breadcrumbs -->

<div class="row">
    <div class="col-lg-12">
        <div class="card mb-2">
            <div class="card-header d-flex flex-wrap align-items-center">
                <h5 class="card-title flex-grow-1">Lista de {{title}}</h5>
                <div class="flex-shrink-0">
                    <div class="d-flex gap-1 flex-wrap ">
                        <button *ngIf="canActivate.includes('REGISTRAR')" (click)="openModal(undefined,'','lg')"
                          type="button" class="btn btn-secondary add-btn" data-bs-toggle="modal">
                          <i class="ri-add-circle-line align-middle"></i>
                          Agregar
                        </button>
                        <button *ngIf="canActivate.includes('REGISTRAR')" (click)="openModalImport()"
                            class="btn btn-soft-primary" >
                            <i class="ri-file-upload-line align-bottom"></i>
                            Importar
                        </button>
                        <button *ngIf="canActivate.includes('VER')" (click)="csvFileExport()"
                            class="btn btn-soft-info" id="remove-actions" style="display: none">
                            <i class="ri-file-download-line align-bottom"></i>
                            Exportar
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-lg-8">
        <div class="card">
            <div class="card-header">
                <div class="row">
                    <div class="col-10 col-lg-6">
                        <div class="search-box">
                            <input type="text" name="searchTerm" class="form-control" placeholder="Buscar por ..."
                                [(ngModel)]="searchTerm" (ngModelChange)="performSearch()">
                            <i class="ri-search-line search-icon"></i>
                        </div>
                    </div>
                    <div class="col-2 col-lg-1 col-sm-1 ms-md-auto">
                        <div class="d-flex align-items-center gap-2">
                          <div class="hstack gap-2">
                            <span class="dropdown d-md-inline-block" ngbDropdown>
                              <button class="btn btn-soft-info btn-icon fs-14 arrow-none d-block" type="button" title="dropdown"
                                      id="dropdownMenuButton1" data-bs-toggle="dropdown" aria-expanded="false"
                                      ngbDropdownToggle>
                                <i class="ri-settings-4-line"></i>
                              </button>
                              <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton1" ngbDropdownMenu>
                                  @for (column of itemsList; track column) {
                                    <li class="dropdown-item p-1">
                                      <div class="form-check form-check-outline form-check-primary">
                                        <input class="form-check-input" type="checkbox" [id]="'formCheck' + column.prop"
                                               [(ngModel)]="column.visible">
                                        <label class="form-check-label" [for]="'formCheck' + column.prop">
                                          {{column.name}}
                                        </label>
                                      </div>
                                    </li>
                                  }
                              </ul>
                            </span>
                          </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="card-body">
            <app-data-table
                [loading]="loading"
                [itemsList]="itemsList"
                [allcontent]="staffList"
                [actions]="{
                  show: canActivate.includes('LISTAR'),
                  edit: canActivate.includes('EDITAR'),
                  close: canActivate.includes('ANULAR')?'Anular':'',}"
                (showItemEmitter)="viewDataGet($event)"
                (editItemEmitter)="openModal($event,'edit','lg')"
                (closeItemEmitter)="deleteModal(deleteModel,$event)"
                [multiCheck]="canActivate.includes('REGISTRAR')"
                (selectedItemEmitter)="getSelectedItems($event)" 
                [viewMode]="viewMode"   
            ></app-data-table>
            </div>
        </div>
    </div>

    <div class="col-lg-4" #viewModel>
        <div class="card" *ngIf="funcionarioSelected != undefined">
            <div class="card-body text-center contact-details">
                <div class="position-relative d-inline-block">
                    <img [src]="'assets/icons/users/' + funcionarioSelected.avatar" alt="Avatar" class="avatar-lg rounded-circle img-thumbnail">
                    <span [class]="'contact-active position-absolute rounded-circle ' + (funcionarioSelected.activo ? 'bg-success' : 'bg-danger')"></span>
                </div>
                <h5 class="mt-2 mb-1">{{funcionarioSelected.nombre}}</h5>
                <p class="text-muted">{{funcionarioSelected.complejoDto?.nombre}}</p>

                <ul class="list-inline mb-1">
                    <li class="list-inline-item avatar-xs">
                        <a href="javascript:void(0);" class="avatar-title bg-success-subtle text-success fs-15 rounded">
                            <i class="ri-phone-line"></i>
                        </a>
                    </li>
                    <li class="list-inline-item avatar-xs">
                        <a href="javascript:void(0);" class="avatar-title bg-danger-subtle text-danger fs-15 rounded">
                            <i class="ri-mail-line"></i>
                        </a>
                    </li>
                    <li class="list-inline-item avatar-xs">
                        <a [href]="'https://api.whatsapp.com/send?phone=+591' + funcionarioSelected.telefono + '&text=MENSAJE DESDE SISTEMA DE DEPORTES'" 
                           class="avatar-title bg-warning-subtle text-warning fs-15 rounded">
                            <i class="lab la-whatsapp"></i>
                        </a>
                    </li>
                </ul>
            </div>
            <div class="card-body">
                <h6 class="text-muted text-uppercase fw-semibold mt-0 mb-4">Información del Cargo</h6>
                <div class="table-responsive table-card">
                    <table class="table table-borderless mb-0">
                        <tbody>
                            <tr>
                                <td class="fw-medium py-1">Complejo:</td>
                                <td class="designation py-1">{{funcionarioSelected.complejoDto?.nombre || 'No asignado'}}</td>
                            </tr>
                            <tr>
                                <td class="fw-medium py-1">Teléfono:</td>
                                <td class="tags-list">
                                    <span class="badge bg-primary-subtle text-primary">{{funcionarioSelected.telefono || 'No especificado'}}</span>
                                </td>
                            </tr>
                            <tr>
                                <td class="fw-medium py-1">Estado:</td>
                                <td class="py-1">
                                    <span [class]="'badge ' + (funcionarioSelected.activo ? 'bg-success' : 'bg-danger')">
                                        {{funcionarioSelected.activo ? 'Activo' : 'Inactivo'}}
                                    </span>
                                </td>
                            </tr>
                            <tr>
                                <td class="fw-medium py-1">Horario:</td>
                                <td class="contacted_date py-1">
                                    <div class="d-flex gap-1">
                                        <span class="badge bg-primary-subtle text-primary">{{ funcionarioSelected.horaEntrada?.slice(0, 5) || 'N/A' }}</span>
                                        <span class="badge bg-primary-subtle text-primary">{{funcionarioSelected.horaSalida?.slice(0, 5) || 'N/A'}}</span>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td class="fw-medium py-1">Fecha Asignación:</td>
                                <td class="contacted_date py-1">
                                    {{formatDate(funcionarioSelected.fechaAsignacion)}}
                                </td>
                            </tr>
                            <tr *ngIf="funcionarioSelected.fechaFinAsignacion">
                                <td class="fw-medium py-1">Fecha Fin:</td>
                                <td class="contacted_date py-1">
                                    {{formatDate(funcionarioSelected.fechaFinAsignacion)}}
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
<!--end row-->

<!-- removeItemModal -->
<ng-template #deleteModel let-modal>
    <div class="modal-content">
        <div class="modal-header">
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" id="btn-close"
                (click)="modal.dismiss('Cross click')"></button>
        </div>
        <div class="modal-body">
            <div class="mt-2 text-center">
                <lord-icon src="https://cdn.lordicon.com/gsqxdxog.json" trigger="loop"
                    colors="primary:#405189,secondary:#f06548" style="width:90px;height:90px"></lord-icon>
                <div class="mt-4 pt-2 fs-15 mx-4 mx-sm-5">
                    <h4>¿Está seguro de eliminar el registro?</h4>
                    <p class="text-muted mx-4 mb-0">
                        Al confirmar la eliminación se quitará toda información de nuestra base de datos.
                    </p>
                </div>
            </div>
            <div class="d-flex gap-2 justify-content-center mt-4 mb-2">
                <button class="btn btn-link link-success fw-medium text-decoration-none" data-bs-dismiss="modal"
                    id="deleteRecord-close" (click)="modal.close('Close click')">
                    <i class="ri-close-line me-1 align-middle"></i> Cancelar
                </button>
                <button type="button" class="btn w-sm btn-danger" id="delete-product" (click)="deleteData()">
                    Sí, Eliminar!
                </button>
            </div>
        </div>
    </div>
</ng-template>